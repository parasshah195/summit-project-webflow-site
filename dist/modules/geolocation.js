"use strict";(()=>{var S=Object.defineProperty;var f=(e,o,t)=>o in e?S(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var a=(e,o,t)=>(f(e,typeof o!="symbol"?o+"":o,t),t);var m=class{constructor(){a(this,"API_BASE","https://applerouth.onecanoe.com/api/public/v2");a(this,"API_ENDPOINT")}async sendQuery(){let o=await fetch(this.API_BASE+this.API_ENDPOINT,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(this.API_BODY)});return o.ok?await o.json():(console.warn(`Error when sending query: ${this.API_BASE}${this.API_ENDPOINT}`),console.warn(o,o.statusText),null)}},E=m;var r="Other",p="OTH",c=4,l=class extends E{constructor(t){super();a(this,"API_ENDPOINT","/geolocation");a(this,"API_BODY");t?this.API_BODY=t:this.API_BODY={type:"ip"}}emptyResponse(){return{market:r,market_nickname:p,market_id:c,city_name:null,state_name:null}}},A=l;var s="geolocation";function u(){let e=localStorage.getItem("_x_geo_source");return e?JSON.parse(e):""}function _(e){window.Alpine.store(s).geo_source=e}function y(e,o,t,n,i){window.Alpine.store(s).market=e,window.Alpine.store(s).market_nickname=o,window.Alpine.store(s).market_id=t,window.Alpine.store(s).city_name=n,window.Alpine.store(s).state_name=i,window.Alpine.store(s).location_name=g(e,n,i)}function g(e,o,t){return o==="-"||o===null?e:t!==""&&t!==null?`${o}, ${t}`:o}document.addEventListener("alpine:init",()=>{window.Alpine.store(s,{geo_source:window.Alpine.$persist(""),market:window.Alpine.$persist(r),market_nickname:window.Alpine.$persist(p),market_id:window.Alpine.$persist(c),city_name:window.Alpine.$persist(r),state_name:window.Alpine.$persist(""),location_name:window.Alpine.$persist(r),init(){window.getCkyConsent&&(getCkyConsent().categories.functional?d():u()==="ip"&&P()),document.addEventListener("cookieyes_consent_update",e=>{let o=e==null?void 0:e.detail;console.debug("cookieyes_consent_update",{eventData:e}),o.accepted.includes("functional")?d():u()==="ip"&&P()})}})});async function d(){let e=localStorage.getItem("_x_market_id"),o=localStorage.getItem("_x_geo_source");if(o=o&&JSON.parse(o),e&&o!==""&&e!=="0"&&o!=="ip")return;u()==="ip"?N():(T(),w())}function w(){var e;(e=navigator.geolocation)==null||e.getCurrentPosition(o=>{let{latitude:t,longitude:n}=o.coords;R(t,n)},o=>{o.code===o.PERMISSION_DENIED?console.error("User denied browser geolocation access"):console.error(`Geolocation error: ${o.message}`)},{timeout:6e4})}async function R(e,o){let t={type:"coord",coord:[e,o]},n=new A(t),i=await n.sendQuery();i.market_id||(i=n.emptyResponse()),_("coord"),I(i)}async function T(){let e={type:"ip"},o=new A(e),t=await o.sendQuery();t.market_id||(t=o.emptyResponse()),_("ip"),I(t)}async function N(){var e;await D()&&((e=navigator.geolocation)==null||e.getCurrentPosition(o=>{let{latitude:t,longitude:n}=o.coords;R(t,n)}))}function I(e){y(e.market,e.market_nickname,e.market_id,e.city_name,e.state_name)}async function D(){return navigator.geolocation?(await navigator.permissions.query({name:"geolocation"})).state==="granted":!1}function P(){window.Alpine.store(s).geo_source="",y(r,p,c,r,"")}})();
