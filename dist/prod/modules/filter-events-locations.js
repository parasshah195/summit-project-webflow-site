"use strict";(()=>{var x=Object.defineProperty;var S=(n,s,e)=>s in n?x(n,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[s]=e;var c=(n,s,e)=>(S(n,typeof s!="symbol"?s+"":s,e),e);var f=class{constructor(){c(this,"API_BASE","https://summit.onecanoe.com/api/public/v2");c(this,"API_ENDPOINT")}async sendQuery(){let s;try{s=await fetch(this.API_BASE+this.API_ENDPOINT,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(this.API_BODY)})}catch(t){return console.error(`Error when sending query: ${this.API_BASE}${this.API_ENDPOINT}`,t),null}return s.ok?await s.json():(console.warn(`Error when sending query: ${this.API_BASE}${this.API_ENDPOINT}`),console.warn(s,s.statusText),null)}},A=f;var _=class extends A{constructor(e){super();c(this,"API_ENDPOINT","/events");c(this,"API_BODY");c(this,"DEFAULT_EVENT_LIMIT",12);this.API_BODY=e,this.setAPIDefaults()}setAPIDefaults(){this.API_BODY.limit||(this.API_BODY.limit=this.DEFAULT_EVENT_LIMIT),this.API_BODY.start||(this.API_BODY.start=0)}async getQueryData(){let e=await this.sendQuery();if(!e)return null;let{data:t}=e;return!t||!t.length?(console.warn(`Empty response from the query: ${this.API_BASE}${this.API_ENDPOINT}`),this.emptyResponse()):t}emptyResponse(){return[]}},E=_;function m(n){try{let s=/'([^']*)'/g,e=JSON.parse(n.replace(s,'"$1"'));return Array.isArray(e)?e:n}catch{return n}}var N="data-topics-exclude";function g(n,s){if(!s||!s.length)return s;let e=n.getAttribute(N);if(!e)return s;let t=m(e);return console.log(t),s=s.filter(r=>!r.topics.some(o=>t.includes(o))),s}function d(n){return!(n.type!=="class"||!n.class_schedule||1>=n.class_schedule.sessions_count)}function h(n){var s,e;return d(n)?dayjs((s=n.class_schedule)==null?void 0:s.first_session.starts_at).format("MMM Do")+" - "+dayjs((e=n.class_schedule)==null?void 0:e.final_session.starts_at).format("MMM Do")+" ("+n.days_of_week.join(", ")+")":dayjs(n.starts_at).format("MMM Do")+" ("+n.days_of_week.join(", ")+")"}var O={Mon:"Mondays",Tue:"Tuesdays",Wed:"Wednesdays",Thu:"Thursdays",Fri:"Fridays",Sat:"Saturdays",Sun:"Sundays"};function I(n,s,e=!0){let t="h:mm A",r=dayjs(n).format(t),o=dayjs(s).format(t),a=dayjs(n).format("z");return e?`${r} - ${o} (${a})`:`${r} - ${o}`}function P(n){let s=new Set,e=Object.keys(O);n.forEach(r=>{r.days_of_week.map(o=>s.add(o))});let t=[...s];return t.sort((r,o)=>e.indexOf(r)-e.indexOf(o)),`Weekly (${t.join(", ")})`}function T(n){let s=new Set,e=["Mornings","Afternoons","Evenings","Nights"];n.forEach(r=>{if(!r.starts_at)return;let o=new Date(r.starts_at).getHours();o>=5&&o<12?s.add(e[0]):o>=12&&o<17?s.add(e[1]):o>=17&&o<21?s.add(e[2]):s.add(e[3])});let t=[...s];return t.sort((r,o)=>e.indexOf(r)-e.indexOf(o)),t.join("/")}function v(n){let s=new Set;return n.forEach(e=>{e.topics.map(t=>s.add(t))}),Array.from(s).join(", ")}var D=["category","market","id","name","event_code","tags","limit","start","topics","before","after","timezone","test_date","is_online","extended_time_available","days_of_week","location_id"];function R(n,s){let e="query-",t=e.length;for(let r of n.attributes)if(r.name.startsWith(e)){let o=r.name.substring(t);D.includes(o)&&(s.apiBody[o]=w(r.value))}}function w(n){if(/^\d+$/.test(n))return Number(n);if(!isNaN(Date.parse(n)))return new Date(n);let s=n.toLowerCase();return s==="true"?!0:s==="false"?!1:m(n)}var L="filters";window.addEventListener("alpine:init",()=>{window.Alpine.data("filterEventsLocations",function(){let n=[];return{isLoading:!1,isQueryError:!1,areEventsAvailable:!0,locationIds:[],locations:[],apiBody:{category:["practice_test"],start:0,limit:30,is_online:!1,timezone:dayjs().format("Z")},filterLocationItemAttr:{[":key"](){return this.location.id}},filterLocationEventsItemAttr:{[":key"](){return this.event.id}},locationImageAttr:{[":src"](){var r;let e=this.$el.getAttribute("src"),t=(r=this.$refs.locationList)==null?void 0:r.querySelector(`img[location_id="${this.location.id}"]`);return t&&t.getAttribute("src")||e},srcset:"",sizes:""},componentEl:null,async init(){var t;await this.$nextTick(),this.componentEl=this.$refs.componentEl,R(this.componentEl,this);let e=(t=this.componentEl)==null?void 0:t.getAttribute("locations");if(e)try{let r=JSON.parse(e.replace(/'/g,'"'));this.locationIds=Array.isArray(r)?r.map(Number):[Number(r)]}catch(r){console.warn("Failed to parse locations attribute:",r)}n.push(window.Alpine.effect(()=>{this.setAPIQueryFilters(),this.$nextTick(()=>{this.processQuery()})}))},destroy(){n.forEach(e=>{window.Alpine.release(e)})},setAPIQueryFilters(){let e=this.$store[L];this.apiBody.topics=e.testTopics,this.apiBody.after=e.start_date,this.apiBody.before=e.end_date,this.apiBody.extended_time_available=e.extended_time_available,this.apiBody.test_date=e.test_date,this.apiBody.days_of_week=e.days_of_week},async queryLocationEvents(e){let t={...this.apiBody};e!==void 0&&(t.location_id=e);let r=await new E(t).getQueryData();return g(this.componentEl,r)||[]},async processQuery(){this.areEventsAvailable=!0,this.isLoading=!0,this.isQueryError=!1,this.locations=[];try{let e=this.locationIds.length>0?this.locationIds:this.apiBody.location_id?[this.apiBody.location_id]:[];if(e.length===0){let a=await this.queryLocationEvents();if(!a||a.length===0){this.areEventsAvailable=!1;return}this.processEventsIntoLocations(a);return}let t=[],r=!1,o=!0;for(let a of e)try{let i=await this.queryLocationEvents(a);i&&i.length>0&&(r=!0,t.push(...i)),o=!1}catch(i){console.warn(`Failed to fetch events for location ${a}:`,i)}if(this.isQueryError=o,!r){this.areEventsAvailable=!1;return}this.processEventsIntoLocations(t)}catch(e){console.error("Error processing query:",e),this.isQueryError=!0}finally{this.isLoading=!1}},processEventsIntoLocations(e){var o;let t=e.reduce((a,i)=>{if(!i.location_id)return a;let l=a.find(p=>p.id===i.location_id);return l?l.events.length<6&&(l.events.push(i),l.nextStart=l.events.length):a.push({id:i.location_id,name:i.location_name,address:i.address,directions:i.google_maps_url,events:[i],eventsDepleted:!1,moreEventsLoading:!1,nextStart:1}),a},[]),r=(o=this.$refs.locationList)==null?void 0:o.querySelectorAll('[data-el="collection-item"]');if(r){let a=Array.from(r).map(i=>i.getAttribute("location_id"));t.sort((i,l)=>{let p=a.findIndex(y=>{var u;return y===((u=i.id)==null?void 0:u.toString())}),b=a.findIndex(y=>{var u;return y===((u=l.id)==null?void 0:u.toString())});return p-b})}this.locations=t,this.fillInitEvents()},async fillInitEvents(){this.locations.forEach(e=>{if(6<=e.events.length)return;let t=6-e.events.length;this.viewMoreEvents(e.id,t,!0)})},async getGroupedDays(e){let t=this.getLocationArrayByID(e);if(t)return await this.$nextTick(),P(t.events)},async getGroupedTimings(e){let t=this.getLocationArrayByID(e);if(t)return await this.$nextTick(),T(t.events)},async getGroupedTests(e){let t=this.getLocationArrayByID(e);if(t)return await this.$nextTick(),v(t.events)},async viewMoreEvents(e,t=6,r=!1){let o=this.getLocationArrayByID(e);if(!o){console.warn("No location found to view more events for the Location ID - ",e);return}let a={...this.apiBody};a.location_id=o.id,a.start=o.nextStart,a.limit=r?t+1:t,o.moreEventsLoading=!0;let i=await new E(a).getQueryData();o.moreEventsLoading=!1,(!i||!i.length||t===6&&i.length<6||r&&i.length<=t)&&(o.eventsDepleted=!0),o.nextStart=o.nextStart+((i==null?void 0:i.length)||0),i=g(this.componentEl,i)||[],i=i.filter(l=>!o.events.some(p=>p.id===l.id)),i.length&&(r&&i.length>t&&i.pop(),o.events.push(...i))},getTimeRange(e,t,r=!0){return I(e,t,r)},getEventDateRange(e){return h(e)},isMultiDayEvent(e){return d(e)},getLocationArrayByID(e){return this.locations.find(t=>t.id===e)}}})});})();
