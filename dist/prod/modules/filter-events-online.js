"use strict";(()=>{var P=Object.defineProperty;var R=(s,t,e)=>t in s?P(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var o=(s,t,e)=>(R(s,typeof t!="symbol"?t+"":t,e),e);var u=class{constructor(){o(this,"API_BASE","https://summit.onecanoe.com/api/public/v2");o(this,"API_ENDPOINT")}async sendQuery(){let t;try{t=await fetch(this.API_BASE+this.API_ENDPOINT,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(this.API_BODY)})}catch(n){return console.error(`Error when sending query: ${this.API_BASE}${this.API_ENDPOINT}`,n),null}return t.ok?await t.json():(console.warn(`Error when sending query: ${this.API_BASE}${this.API_ENDPOINT}`),console.warn(t,t.statusText),null)}},f=u;var d=class extends f{constructor(e){super();o(this,"API_ENDPOINT","/events");o(this,"API_BODY");o(this,"DEFAULT_EVENT_LIMIT",12);this.API_BODY=e,this.setAPIDefaults()}setAPIDefaults(){this.API_BODY.limit||(this.API_BODY.limit=this.DEFAULT_EVENT_LIMIT),this.API_BODY.start||(this.API_BODY.start=0)}async getQueryData(){let e=await this.sendQuery();if(!e)return null;let{data:n}=e;return!n||!n.length?(console.warn(`Empty response from the query: ${this.API_BASE}${this.API_ENDPOINT}`),this.emptyResponse()):n}emptyResponse(){return[]}},m=d;function l(s){try{let t=/'([^']*)'/g,e=JSON.parse(s.replace(t,'"$1"'));return Array.isArray(e)?e:s}catch{return s}}var D="data-topics-exclude";function y(s,t){if(!t||!t.length)return t;let e=s.getAttribute(D);if(!e)return t;let n=l(e);return console.log(n),t=t.filter(r=>!r.topics.some(i=>n.includes(i))),t}function a(s){return!(s.type!=="class"||!s.class_schedule||1>=s.class_schedule.sessions_count)}function E(s){var t,e;return a(s)?dayjs((t=s.class_schedule)==null?void 0:t.first_session.starts_at).format("MMM Do")+" - "+dayjs((e=s.class_schedule)==null?void 0:e.final_session.starts_at).format("MMM Do")+" ("+s.days_of_week.join(", ")+")":dayjs(s.starts_at).format("MMM Do")+" ("+s.days_of_week.join(", ")+")"}var I={Mon:"Mondays",Tue:"Tuesdays",Wed:"Wednesdays",Thu:"Thursdays",Fri:"Fridays",Sat:"Saturdays",Sun:"Sundays"};function h(s,t,e=!0){let n="h:mm A",r=dayjs(s).format(n),i=dayjs(t).format(n),p=dayjs(s).format("z");return e?`${r} - ${i} (${p})`:`${r} - ${i}`}function A(s){let t=new Set,e=Object.keys(I);s.forEach(r=>{r.days_of_week.map(i=>t.add(i))});let n=[...t];return n.sort((r,i)=>e.indexOf(r)-e.indexOf(i)),`Weekly (${n.join(", ")})`}function g(s){let t=new Set,e=["Mornings","Afternoons","Evenings","Nights"];s.forEach(r=>{if(!r.starts_at)return;let i=new Date(r.starts_at).getHours();i>=5&&i<12?t.add(e[0]):i>=12&&i<17?t.add(e[1]):i>=17&&i<21?t.add(e[2]):t.add(e[3])});let n=[...t];return n.sort((r,i)=>e.indexOf(r)-e.indexOf(i)),n.join("/")}function _(s){let t=new Set;return s.forEach(e=>{e.topics.map(n=>t.add(n))}),Array.from(t).join(", ")}var T=["category","market","id","name","event_code","tags","limit","start","topics","before","after","timezone","test_date","is_online","extended_time_available","days_of_week","location_id"];function v(s,t){let e="query-",n=e.length;for(let r of s.attributes)if(r.name.startsWith(e)){let i=r.name.substring(n);T.includes(i)&&(t.apiBody[i]=w(r.value))}}function w(s){if(/^\d+$/.test(s))return Number(s);if(!isNaN(Date.parse(s)))return new Date(s);let t=s.toLowerCase();return t==="true"?!0:t==="false"?!1:l(s)}var c="filters";window.addEventListener("alpine:init",()=>{window.Alpine.data("filterEventsOnline",function(){let t=[];return{isLoading:!1,areEventsAvailable:!0,isQueryError:!1,events:[],moreEventsLoading:!1,eventsDepleted:!1,apiBody:{category:["practice_test"],start:0,limit:6,is_online:!0,timezone:dayjs().format("Z")},filterOnlineEventsItemAttr:{[":key"](){return this.event.id}},componentEl:null,async init(){await this.$nextTick(),this.componentEl=this.$refs.componentEl,v(this.componentEl,this),this.apiBody.limit=6,t.push(window.Alpine.effect(()=>{this.setAPIQueryFilters(),this.$nextTick(()=>{this.processQuery()})}))},destroy(){t.forEach(e=>{window.Alpine.release(e)})},setAPIQueryFilters(){let e=this.$store[c];this.apiBody.topics=e.testTopics,this.apiBody.after=e.start_date,this.apiBody.before=e.end_date,this.apiBody.extended_time_available=e.extended_time_available,this.apiBody.test_date=e.test_date,this.apiBody.days_of_week=e.days_of_week},async processQuery(){this.events=[],this.areEventsAvailable=!0,this.eventsDepleted=!1,this.apiBody.start=0,this.isLoading=!0,await this.sendQuery(),this.isLoading=!1},async sendQuery(){this.isQueryError=!1;let e=await new m(this.apiBody).getQueryData();if(!e){this.isQueryError=!0;return}if(!e.length){this.areEventsAvailable=!1;return}if(e.length<6&&(this.eventsDepleted=!0),e=y(this.componentEl,e),e=(e==null?void 0:e.filter(n=>!this.events.some(r=>r.id===n.id)))||[],!e.length){this.areEventsAvailable=!1;return}this.events.push(...e),await this.$nextTick()},getGroupedDays(){return A(this.events)},getGroupedTimings(){return g(this.events)},getGroupedTests(){return _(this.events)},async viewMoreEvents(){this.apiBody.start||(this.apiBody.start=0),this.moreEventsLoading=!0,this.apiBody.start+=6;try{let e=await new m(this.apiBody).getQueryData();if(!e||e.length<6){this.eventsDepleted=!0;return}e=y(this.componentEl,e),e=(e==null?void 0:e.filter(n=>!this.events.some(r=>r.id===n.id)))||[],this.events.push(...e)}catch(e){console.error(e)}finally{this.$nextTick(()=>{this.moreEventsLoading=!1})}},getTimeRange(e,n,r=!0){return h(e,n,r)},getEventDateRange(e){return E(e)},isMultiDayEvent(e){return a(e)}}}),window.Alpine.data("filterEventsOnlineOnDemand",function(){let t=[],e="grid";return{filterName:void 0,filterEventCount:0,eventRowsElList:void 0,eventNamesElList:void 0,async init(){var n,r;await this.$nextTick(),this.eventRowsElList=(n=this.$refs.eventsListEl)==null?void 0:n.querySelectorAll("[data-event-row]"),this.eventNamesElList=(r=this.$refs.eventsListEl)==null?void 0:r.querySelectorAll("[data-event-name]"),this.eventRowsElList&&(e=this.eventRowsElList[0].style.display),t.push(window.Alpine.effect(()=>{this.setFilterStoreWatcher()}))},destroy(){t.forEach(n=>{window.Alpine.release(n)})},setFilterStoreWatcher(){var r;if(this.filterName=this.$store[c].testName,this.filterEventCount=0,!this.eventRowsElList||!this.eventRowsElList.length)return;this.eventRowsElList.forEach(i=>{i.style.display=e});let n=new RegExp(`\\b${this.filterName}\\b`,"gi");(r=this.eventNamesElList)==null||r.forEach((i,p)=>{i.innerText.match(n)?this.filterEventCount+=1:this.eventRowsElList&&(this.eventRowsElList[p].style.display="none")})}}})});})();
